(()=>{"use strict";class t{constructor(){this.cells={};const t=this;this.stats={t:0,get i(){return Object.keys(t.cells).length}}}static h(t,i){return`${t}/${i}`}static o(t){return t.split("/").map(Number)}static l(t,i){return[[t-1,i-1],[t,i-1],[t+1,i-1],[t-1,i],[t+1,i],[t-1,i+1],[t,i+1],[t+1,i+1]]}u(i,s){this.cells[t.h(i,s)]=!0}m(i,s){delete this.cells[t.h(i,s)]}p(i,s){return Boolean(this.cells[t.h(i,s)])}C(i,s){return t.l(i,s).reduce(((t,[i,s])=>t+Number(this.p(i,s))),0)}v(t,i){return 3===this.C(t,i)}k(t,i){const s=this.C(t,i);return s<2||s>3}M(t,i){return!this.k(t,i)&&(!!this.v(t,i)||this.p(t,i))}P(){const i={};for(const s in this.cells){const[e,h]=t.o(s);[[e,h],...t.l(e,h)].forEach((([s,e])=>{this.M(s,e)&&(i[t.h(s,e)]=!0)}))}this.cells=i,this.stats.t++}}function i(t,i=null){t.addEventListener("click",(s=>{const e=t.getBoundingClientRect(),h=Math.floor((s.clientX-e.left)/(t.width/t.clientWidth)),n=Math.floor((s.clientY-e.top)/(t.height/t.clientHeight));i&&i({x:h,y:n})}))}function s(t,i=null){t.addEventListener("mousemove",(s=>{const e=t.getBoundingClientRect(),h=Math.floor((s.clientX-e.left)/(t.width/t.clientWidth)),n=Math.floor((s.clientY-e.top)/(t.height/t.clientHeight));i&&i({x:h,y:n})}))}class e{constructor({$:t=16,gap:i=1,width:s=null,height:e=null,theme:h="dark"}={}){if(this.$=t,this.gap=i,s??=32*t+31*i,e??=32*t+31*i,this.canvas=function({width:t=800,height:i=600}={}){const s=document.createElement("canvas");return s.width=t,s.height=i,s}({width:s,height:e}),this.B=this.canvas.getContext("2d"),"light"===h)this.theme={grid:"#eee",G:"#f5f7fb",N:"#080a0c",A:"#101828",T:"#fff"};else this.theme={grid:"#181b21",G:"#080a0c",N:"#e4ebf5",A:"#e8eef6",T:"#080a0c"};this.W={x:s-50,y:6,width:3*(t+i)-12,height:3*(t+i)-12},this.F=new Image,this.F.src=`assets/play-${h}.svg`,this.I=new Image,this.I.src=`assets/pause-${h}.svg`,this.K(),this.F.addEventListener("load",(()=>{this.O()}),{once:!0})}O({t=0,i=0,R:s=!1}={}){this.B.fillStyle=this.theme.A,this.B.fillRect(0,0,this.canvas.width,3*(this.$+this.gap)),this.B.font="20px monospace",this.B.fillStyle=this.theme.T,this.B.fillText(`Generation: ${t}  -  Population: ${i}`,10,30);const{x:e,y:h,width:n,height:o}=this.W;this.B.drawImage(s?this.I:this.F,e,h,n,o)}K(){this.B.fillStyle=this.theme.G,this.B.fillRect(0,0,this.canvas.width,this.canvas.height),this.B.fillStyle=this.theme.grid;for(let t=0;t<this.canvas.width;t+=this.$+this.gap)this.B.fillRect(t,0,this.gap,this.canvas.height);for(let t=0;t<this.canvas.height;t+=this.$+this.gap)this.B.fillRect(0,t,this.canvas.width,this.gap)}j(t,i,s=null){!function(t,i,s,e,h="#000"){const n=t.getContext("2d");n.fillStyle=h,n.fillRect(i,s,e,e)}(this.canvas,(t+1)*this.gap+t*this.$,(i+1)*this.gap+i*this.$,this.$,s??this.theme.N)}D(t){i(this.canvas,(({x:i,y:s})=>{const e=Math.floor(i/(this.$+this.gap)),h=Math.floor(s/(this.$+this.gap));h>2&&t({x:e,y:h})}))}S(t){!function(t,{x:e,y:h,width:n,height:o}={},r=null){s(t,(({x:i,y:s})=>{t.style.cursor=i>=e&&i<=e+n&&s>=h&&s<=h+o?"pointer":"default"})),i(t,(({x:t,y:i})=>{t>=e&&t<=e+n&&i>=h&&i<=h+o&&r&&r({x:t,y:i})}))}(this.canvas,this.W,t)}}function h(i,s,e=!1){i.K();for(const e in s.cells){const[s,h]=t.o(e);i.j(s,h)}i.O({...s.stats,R:e})}const n=new t,o=function({$:t=16,gap:i=1,theme:s="dark"}={}){const h=window.innerWidth,n=window.innerHeight,o=new e({$:t,gap:i,width:h,height:n,theme:s});return document.body.appendChild(o.canvas),o}({theme:"dark"});o.D((({x:t,y:i})=>{a.q||(n.p(t,i)?n.m(t,i):n.u(t,i),h(o,n))}));const r=t=>new Promise((i=>setTimeout(i,t))),a={state:"stopped",get q(){return"running"===this.state},set q(t){this.state=t?"running":"stopped"},async start(t){for(this.state="running";this.q;)await Promise.all([r(t),new Promise((t=>{n.P(),t()}))]),h(o,n,this.q)},async stop(){this.q=!1},async toggle(t){this.q?await this.stop():await this.start(t)}};document.addEventListener("keydown",(t=>{" "===t.key&&a.toggle(50)})),o.S((()=>a.toggle(50)))})();